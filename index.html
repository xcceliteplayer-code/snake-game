<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Snake Multiplayer Firebase</title>
  <style>
    body { text-align: center; font-family: Arial }
    canvas { border: 2px solid #000 }
  </style>
</head>
<body>

<h2>ğŸ Snake Multiplayer</h2>
<p>Buka di 2 tab / 2 HP</p>
<canvas id="game" width="400" height="400"></canvas>

<script type="module">
/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getDatabase, ref, set, onValue, remove } 
from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCLRvyfE_ZgG20sZuWVge2baOElVSluvKk",
  authDomain: "snake-game-6d2fe.firebaseapp.com",
  databaseURL: "https://snake-game-6d2fe-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "snake-game-6d2fe",
  storageBucket: "snake-game-6d2fe.firebasestorage.app",
  messagingSenderId: "881486411840",
  appId: "1:881486411840:web:250ca2d50a9dfbf65007a5"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ================= GAME ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const GRID = 20;
const SIZE = 18;

const playerId = "player_" + Math.floor(Math.random() * 99999);
const playerRef = ref(db, "players/" + playerId);

let snake = [{ x: 200, y: 200 }];
let dir = { x: GRID, y: 0 };

document.addEventListener("keydown", e => {
  if (e.key === "ArrowUp") dir = { x: 0, y: -GRID };
  if (e.key === "ArrowDown") dir = { x: 0, y: GRID };
  if (e.key === "ArrowLeft") dir = { x: -GRID, y: 0 };
  if (e.key === "ArrowRight") dir = { x: GRID, y: 0 };
});

function update() {
  const head = {
    x: (snake[0].x + dir.x + 400) % 400,
    y: (snake[0].y + dir.y + 400) % 400
  };

  snake.unshift(head);
  snake.pop();

  set(playerRef, snake);
}

onValue(ref(db, "players"), snap => {
  ctx.clearRect(0, 0, 400, 400);
  const players = snap.val();
  if (!players) return;

  Object.values(players).forEach(s => {
    s.forEach(p => {
      ctx.fillRect(p.x, p.y, SIZE, SIZE);
    });
  });
});

window.addEventListener("beforeunload", () => {
  remove(playerRef);
});

setInterval(update, 150);
</script>

</body>
</html>
